<!DOCTYPE html>
<!--
Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.

Licensed under the Amazon Software License (the "License"). You may not use this file except in compliance with the License. A copy of the License is located at

    http://aws.amazon.com/asl/

or in the "license" file accompanying this file. This file is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions and limitations under the License.
-->
<html lang="en">

<head>
    <title>BAMTech Game Chat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="css/bootstrap.4.0.0-alpha.6.min.css">
    <link rel="stylesheet" href="css/chat2.css">
</head>

<body id = "bootstrap-override">
    <div id="app">
        <div class="container-fluid">
            <div class="row">
            <nav class="col-sm-1 bg-faded games">
                    <div class="row games-header">
                        <div class="col-sm-8">
                            Games
                        </div>
                    </div>
                    <div class="row games-body" v-cloak>
                        <ul class="list-group games-group">
                            <li class="list-group-item rooms-item justify-content-between bg-faded room-name-clickable" v-for="(value, key) in members" onclick="switchRooms(this)">
                                <small class="room-name-clickable" v-bind:id="value.username"> {{ value.username }}</small>
                            </li>
                        </ul>
                    </div>
   </nav>
                <nav class="col-sm-7 offset-sm-1 bg-faded video">
                                <iframe src="http://www.youtube.com/embed/W7qWa52k-nE"
   width="560" height="315" frameborder="0"></iframe>
                </nav>
                                <main class="col-sm-4 offset-sm-8 messages-main bg-faded messages">
                    <div class="row messages-header">
                        <div class="col-sm-12">
                            Messages
                        </div>
                    </div>
                    <div class="row messages-body" v-cloak>
                        <div class="col-sm-12" id="message-column">
                            <ul class="list-group message-group">
                            	<ul class="message-ul" v-for="message in messages" track-by="$index">
                            		<li><img v-bind:src="message.avatar" class="members-avatar"> <small class="text-muted">{{ message.username }} {{ formatMessageDate(message.date) }}</small></li>
                            		<li><small class="chat-message">{{ message.message }}</small></li>
                            	</ul>
                            </ul>
                        </div>
                    </div>
                    <div class="row messages-footer bg-faded">
                        <div class="input-group">
                            <input type="text" class="form-control" v-focus="true" v-model="message" v-on:keyup.enter="send" placeholder="Message text...">
                            <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button">Send</button>
                                </span>
                        </div>
                    </div>
                </main>
                <nav class="col-sm-1 offset-sm-11 bg-faded members">
                    <div class="row members-header">
                        <div class="col-sm-12">
                            Members
                        </div>
                    </div>
                    <div class="row members-body" v-cloak>
                        <ul class="list-group members-group">
                            <li class="member-item justify-content-between bg-faded" v-for="(value, key) in members">
                                <img v-bind:src="value.avatar" class="members-avatar">
                                <small> {{ value.username }}</small>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <script src="js/vue/2.1.10/vue.min.js"></script>
    <script src="js/vue-focus/2.1.0/vue-focus.min.js"></script>
    <script src="js/socket.io/1.7.2/socket.io.min.js"></script>
    <script src="js/moment.js/2.17.1/moment.min.js"></script>
    <script src="js/jquery-3.2.1.js"></script>
    
    <script>
    	$(document).ready(function() {
    	console.log(this);
    	localStorage.setItem('activeRoomId', '');
    	console.log(members);
    		var i = 0;
    		$(".room-name-clickable").click(function(room) {
    			alert(room);
    			console.log(room);
    			
    		});
    	});
    </script>
    
    <script>
    	function switchRooms(id){
    		alert(id.childNodes[0].id);
    		i++;
    		alert(i);
    	}
    </script>

    <script>
        var socket = io();
        console.log(this);

        new Vue({
            el: '#app',
            mixins: [VueFocus.mixin],
            data: {
                message: '',
                messages: [],
                members: {},
                rooms: {}
            },
            methods: {
                send: function() {
                    socket.emit('send', this.message);
                    this.message = '';
                },
                formatMemberDate: function(date) {
                    return moment(date).format("h:mm:ss a");
                },
                formatMessageDate: function(date) {
                    return moment(date).format("h:mm:ss a");
                }
            },
            mounted: function() {
                socket.on('messages', function(message) {
                    this.messages.push(message);
                }.bind(this));
                
                socket.on('rooms', function(room){
                	this.rooms.push(room);
                }.bind(this));

                socket.on('member_add', function(member) {
                    Vue.set(this.members, member.socket, member);
                }.bind(this));

                socket.on('member_delete', function(socket_id) {
                    Vue.delete(this.members, socket_id);
                }.bind(this));

                socket.on('message_history', function(messages) {
                    this.messages = messages;
                }.bind(this));

                socket.on('member_history', function(members) {
                    this.members = members;
                }.bind(this));
            }
        });
    </script>
</body>

</html>

<!-- curl localhost:3000/rooms-->